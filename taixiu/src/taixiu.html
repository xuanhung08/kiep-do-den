<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>TÃ i Xá»‰u â€“ Soi Cáº§u + CÆ°á»£c</title>

    <style>
        body {
            font-family: Arial;
            background: #0f172a;
            color: #e5e7eb;
            text-align: center;
        }

        h1 { color: #38bdf8; }

        button {
            padding: 10px 20px;
            margin: 6px;
            font-size: 16px;
        }

        input {
            padding: 8px;
            font-size: 16px;
            width: 150px;
        }

        canvas {
            background: #020617;
            border: 1px solid #334155;
            margin-top: 20px;
        }

        /* XÃšC Xáº®C */
        #diceBox {
            position: relative;
            height: 140px;
            margin-top: 10px;
        }

        .dice {
            font-size: 48px;
            position: absolute;
            top: -80px;
            left: 50%;
            transform: translateX(-50%);
            display: none;
        }

        .drop {
            animation: dropDice 0.9s ease-out forwards;
        }

        @keyframes dropDice {
            0% { top: -80px; transform: translateX(-50%) rotate(0deg); }
            70% { top: 60px; transform: translateX(-50%) rotate(360deg); }
            100% { top: 50px; transform: translateX(-50%) rotate(380deg); }
        }
    </style>
</head>

<body>

<h1>ðŸŽ² TÃ€I Xá»ˆU â€“ SOI Cáº¦U + CÆ¯á»¢C</h1>

<div>ðŸ’° Sá»‘ dÆ°: <b id="balance">1000</b></div>
<br>

<input type="number" id="betAmount" value="50" min="1">
<br><br>

<button onclick="datCuoc(1)">CÆ°á»£c TÃ i</button>
<button onclick="datCuoc(0)">CÆ°á»£c Xá»‰u</button>
<button onclick="xocDia()">XÃ³c Ä‘Ä©a</button>
<button onclick="resetGame()">Reset</button>

<div id="diceBox">
    <div id="dice" class="dice">ðŸŽ² ðŸŽ² ðŸŽ²</div>
</div>

<div id="result" style="margin-top:10px;font-size:20px;font-weight:bold"></div>
<div id="info" style="margin-top:10px"></div>

<canvas id="cau" width="800" height="300"></canvas>

<script>
    let history = [];
    let balance = 1000;
    let betChoice = null;
    let betMoney = 0;
    let isXoc = false;

    const canvas = document.getElementById("cau");
    const ctx = canvas.getContext("2d");
    const dice = document.getElementById("dice");

    function updateBalance() {
        document.getElementById("balance").innerText = balance;
    }

    function datCuoc(choice) {
        if (isXoc) return;

        let money = parseInt(document.getElementById("betAmount").value);
        if (money <= 0 || money > balance) {
            alert("Tiá»n cÆ°á»£c khÃ´ng há»£p lá»‡");
            return;
        }

        betChoice = choice;
        betMoney = money;
        document.getElementById("result").innerHTML =
            "ðŸ‘‰ ÄÃ£ cÆ°á»£c " + (choice ? "TÃ€I" : "Xá»ˆU") + " : " + money;
    }

    function xocDia() {
        if (isXoc) return;
        if (betChoice === null) {
            alert("Báº¡n chÆ°a Ä‘áº·t cÆ°á»£c");
            return;
        }

        isXoc = true;
        let count = 5;

        document.getElementById("result").innerHTML =
            "â³ Äang xÃ³c Ä‘Ä©a: " + count;

        const timer = setInterval(() => {
            count--;
            if (count > 0) {
                document.getElementById("result").innerHTML =
                    "â³ Äang xÃ³c Ä‘Ä©a: " + count;
            } else {
                clearInterval(timer);
                thaXucXac();
            }
        }, 1000);
    }

    function thaXucXac() {
        dice.style.display = "block";
        dice.classList.remove("drop");
        void dice.offsetWidth; // reset animation
        dice.classList.add("drop");

        setTimeout(() => {
            tinhKetQua();
            dice.style.display = "none";
            isXoc = false;
        }, 900);
    }

    function tinhKetQua() {
        // 3 xÃºc xáº¯c (1â€“6)
        let d1 = Math.floor(Math.random() * 6) + 1;
        let d2 = Math.floor(Math.random() * 6) + 1;
        let d3 = Math.floor(Math.random() * 6) + 1;
        let sum = d1 + d2 + d3;

        let result = sum >= 11 ? 1 : 0; // TÃ i â‰¥ 11
        history.push(result);

        let ketQuaText = `ðŸŽ² ${d1} - ${d2} - ${d3} (Tá»•ng: ${sum})`;

        if (result === betChoice) {
            balance += betMoney;
            document.getElementById("result").innerHTML =
                `âœ… Tháº¯ng! ${ketQuaText} â†’ ${result ? "TÃ€I" : "Xá»ˆU"}`;
        } else {
            balance -= betMoney;
            document.getElementById("result").innerHTML =
                `âŒ Thua! ${ketQuaText} â†’ ${result ? "TÃ€I" : "Xá»ˆU"}`;
        }

        betChoice = null;
        betMoney = 0;

        updateBalance();
        drawCau();
        soiCau();
    }

    function drawCau() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.beginPath();
        ctx.strokeStyle = "#38bdf8";
        ctx.lineWidth = 2;

        history.forEach((v, i) => {
            let x = 40 + i * 40;
            let y = v ? 80 : 220;

            if (i === 0) ctx.moveTo(x, y);
            else ctx.lineTo(x, y);

            ctx.fillStyle = v ? "#22c55e" : "#ef4444";
            ctx.beginPath();
            ctx.arc(x, y, 6, 0, Math.PI * 2);
            ctx.fill();
        });

        ctx.stroke();
    }

    function soiCau() {
        let text = "Cáº§u: " + history.map(v => v ? "T" : "X").join(" ");
        document.getElementById("info").innerHTML = text;
    }

    function resetGame() {
        history = [];
        balance = 1000;
        betChoice = null;
        betMoney = 0;
        isXoc = false;
        dice.style.display = "none";
        ctx.clearRect(0,0,canvas.width,canvas.height);
        document.getElementById("info").innerHTML = "";
        document.getElementById("result").innerHTML = "";
        updateBalance();
    }

    updateBalance();
</script>

</body>
</html>
